<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Google Drive</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .album { margin: 20px 0; }
        .album-title { font-size: 24px; font-weight: bold; margin-top: 20px; }
        .image-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        .image-container img { width: 150px; height: 150px; object-fit: cover; border-radius: 10px; }
        .error-message { color: red; font-size: 18px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Portfolio Google Drive</h1>
    <div id="loading-message">Chargement en cours...</div>
    <div id="portfolio-gallery"></div>
    <div id="error-container" class="error-message"></div>

    <script>
        const API_KEY = "AIzaSyC8gSxfnMK58E4-rAxRO3OzDwCYQoDgo3c";
        const ROOT_FOLDER_ID = "1KNYudPsb9yYCUnTmkWgNV0wxSqhyCAnD";

        async function fetchAlbums() {
            try {
                // Récupérer les sous-dossiers (albums)
                const albumUrl = `https://www.googleapis.com/drive/v3/files?q='${ROOT_FOLDER_ID}'+in+parents+and+mimeType='application/vnd.google-apps.folder'&key=${API_KEY}`;
                const albumResponse = await fetch(albumUrl);
                const albumData = await albumResponse.json();

                if (!albumData.files || albumData.files.length === 0) {
                    throw new Error("Aucun album trouvé.");
                }

                // Traiter chaque album
                for (const album of albumData.files) {
                    await fetchImages(album);
                }

                document.getElementById("loading-message").style.display = "none";
            } catch (error) {
                document.getElementById("error-container").textContent = "Erreur: " + error.message;
            }
        }

        async function fetchImages(album) {
            try {
                // Récupérer les images dans chaque album
                const imageUrl = `https://www.googleapis.com/drive/v3/files?q='${album.id}'+in+parents+and+mimeType contains 'image/'&key=${API_KEY}&fields=files(id,name,thumbnailLink,webContentLink)`;
                const imageResponse = await fetch(imageUrl);
                const imageData = await imageResponse.json();

                // Création du bloc d'album
                const galleryContainer = document.getElementById("portfolio-gallery");
                const albumDiv = document.createElement("div");
                albumDiv.classList.add("album");

                const title = document.createElement("div");
                title.classList.add("album-title");
                title.textContent = album.name;

                const imageContainer = document.createElement("div");
                imageContainer.classList.add("image-container");

                if (imageData.files.length === 0) {
                    const noImages = document.createElement("p");
                    noImages.textContent = "Aucune image disponible.";
                    imageContainer.appendChild(noImages);
                } else {
                    imageData.files.forEach(file => {
                        const img = document.createElement("img");
                        img.src = file.thumbnailLink || `https://drive.google.com/thumbnail?id=${file.id}&sz=500`;
                        img.alt = file.name;
                        img.onerror = () => {
                            img.src = "https://via.placeholder.com/150?text=Image+Introuvable";
                        };
                        imageContainer.appendChild(img);
                    });
                }

                albumDiv.appendChild(title);
                albumDiv.appendChild(imageContainer);
                galleryContainer.appendChild(albumDiv);
            } catch (error) {
                console.error("Erreur de récupération des images:", error);
            }
        }

        document.addEventListener("DOMContentLoaded", fetchAlbums);
    </script>
</body>
</html>
